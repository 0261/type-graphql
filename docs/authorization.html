<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Authorization · TypeGraphQL</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Authorization · TypeGraphQL"/><meta property="og:type" content="website"/><meta property="og:url" content="https://19majkel94.github.io/type-graphql/index.html"/><meta property="og:description" content="Authorization is a core feature used in almost all APIs. Sometimes we want to restrict access to some actions or reading some data only for specific group of users."/><link rel="shortcut icon" href="/type-graphql/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css"/><link rel="alternate" type="application/atom+xml" href="https://19majkel94.github.io/blog/atom.xml" title="TypeGraphQL Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://19majkel94.github.io/blog/feed.xml" title="TypeGraphQL Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/type-graphql/css/main.css"/></head><body class="sideNavVisible doc separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/type-graphql/"><img class="logo" src="/type-graphql/img/logo.png"/><h2 class="headerTitle">TypeGraphQL</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/type-graphql/docs/introduction.html" target="_self">Docs</a></li><li class=""><a href="/type-graphql/docs/examples.html" target="_self">Examples</a></li><li class=""><a href="/type-graphql/docs/faq.html" target="_self">FAQ</a></li><li class=""><a href="/type-graphql/blog" target="_self">Blog</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search"/></li><li class=""><a href="https://github.com/19majkel94/type-graphql" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Features</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Introduction</h3><ul><li class="navListItem"><a class="navItem" href="/type-graphql/docs/introduction.html">What &amp; Why</a></li></ul></div><div class="navGroup navGroupActive"><h3>Beginner guides</h3><ul><li class="navListItem"><a class="navItem" href="/type-graphql/docs/getting-started.html">Getting started</a></li><li class="navListItem"><a class="navItem" href="/type-graphql/docs/types-and-fields.html">Types and fields</a></li><li class="navListItem"><a class="navItem" href="/type-graphql/docs/resolvers.html">Resolvers</a></li><li class="navListItem"><a class="navItem" href="/type-graphql/docs/bootstrap.html">Bootstrapping</a></li></ul></div><div class="navGroup navGroupActive"><h3>Advanced guides</h3><ul><li class="navListItem"><a class="navItem" href="/type-graphql/docs/scalars.html">Scalars</a></li><li class="navListItem"><a class="navItem" href="/type-graphql/docs/enums.html">Enums</a></li><li class="navListItem"><a class="navItem" href="/type-graphql/docs/unions.html">Unions</a></li><li class="navListItem"><a class="navItem" href="/type-graphql/docs/interfaces-and-inheritance.html">Interfaces and inheritance</a></li><li class="navListItem"><a class="navItem" href="/type-graphql/docs/subscriptions.html">Subscriptions</a></li></ul></div><div class="navGroup navGroupActive"><h3>Features</h3><ul><li class="navListItem"><a class="navItem" href="/type-graphql/docs/dependency-injection.html">Dependency injection</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/type-graphql/docs/authorization.html">Authorization</a></li><li class="navListItem"><a class="navItem" href="/type-graphql/docs/validation.html">Validation</a></li><li class="navListItem"><a class="navItem" href="/type-graphql/docs/middlewares.html">Middlewares and guards</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/19majkel94/type-graphql/edit/master/docs/authorization.md" target="_blank">Edit</a><h1>Authorization</h1></header><article><div><span><p>Authorization is a core feature used in almost all APIs. Sometimes we want to restrict access to some actions or reading some data only for specific group of users.</p>
<p>In express.js (and other Node.js framework) we use middlewares for this, like <code>passport.js</code> or the custom ones. However in GraphQL's resolvers architecture we don't have middlewares so we have to imperatively call the auth checking function and manually passing context data in each resolver, which might be quite tedious work.</p>
<p>And that's why authorization is a first-class feature in <code>TypeGraphQL</code>!</p>
<h2><a class="anchor" aria-hidden="true" id="how-to-use"></a><a href="#how-to-use" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to use?</h2>
<p>At first, you need to use <code>@Authorized</code> decorator as a guard on a field or a query/mutation.
Example object type's fields guards:</p>
<pre><code class="hljs css ts"><span class="hljs-meta">@ObjectType</span>()
<span class="hljs-keyword">class</span> MyObject {
  <span class="hljs-meta">@Field</span>()
  publicField: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Field</span>()
  authorizedField: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@Authorized</span>(<span class="hljs-string">"ADMIN"</span>)
  <span class="hljs-meta">@Field</span>()
  adminField: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@Authorized</span>([<span class="hljs-string">"ADMIN"</span>, <span class="hljs-string">"MODERATOR"</span>])
  <span class="hljs-meta">@Field</span>({ nullable: <span class="hljs-literal">true</span> })
  hiddenField?: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p>You can leave the <code>@Authorized</code> decorator brackets empty or you can specify the roles that the user needs to have to get access to the field, query or mutation.</p>
<p>This way authed users (regardless of theirs roles) could read only <code>publicField</code> or <code>authorizedField</code> from <code>MyObject</code> object. They will receive <code>null</code> when accessing <code>hiddenField</code> field and will receive error (that will propagate through the whole query tree looking for nullable field) for <code>adminField</code> when they don't satisfy roles constraints.</p>
<p>Sample query and mutations guards:</p>
<pre><code class="hljs css ts"><span class="hljs-meta">@Resolver</span>()
<span class="hljs-keyword">class</span> MyResolver {
  <span class="hljs-meta">@Query</span>()
  publicQuery(): MyObject {
    <span class="hljs-keyword">return</span> {
      publicField: <span class="hljs-string">"Some public data"</span>,
      authorizedField: <span class="hljs-string">"Data only for logged users"</span>,
      adminField: <span class="hljs-string">"Top secret info for admin"</span>,
    };
  }

  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Query</span>()
  authedQuery(): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Only for authed users!"</span>;
  }

  <span class="hljs-meta">@Authorized</span>(<span class="hljs-string">"ADMIN"</span>, <span class="hljs-string">"MODERATOR"</span>)
  <span class="hljs-meta">@Mutation</span>()
  adminMutation(): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"You are an admin/moderator, you can safely drop database ;)"</span>;
  }
}
</code></pre>
<p>Authed users (regardless of theirs roles) will be able to read data from <code>publicQuery</code> and <code>authedQuery</code> but will receive error trying to perform <code>adminMutation</code> when their roles doesn't include <code>ADMIN</code> or <code>MODERATOR</code>.</p>
<p>In next step, you need to create your auth checker function. Its implementation may depends on your business logic:</p>
<pre><code class="hljs css ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> customAuthChecker: AuthChecker&lt;ContextType&gt; = 
  <span class="hljs-function">(<span class="hljs-params">{ root, args, context, info }, roles</span>) =&gt;</span> {
    <span class="hljs-comment">// here you can read user from context</span>
    <span class="hljs-comment">// and check his permission in db against `roles` argument</span>
    <span class="hljs-comment">// that comes from `@Authorized`, eg. ["ADMIN", "MODERATOR"]</span>

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// or false if access denied</span>
  }
</code></pre>
<p>The last step is to register the function while building the schema:</p>
<pre><code class="hljs css ts"><span class="hljs-keyword">import</span> { customAuthChecker } <span class="hljs-keyword">from</span> <span class="hljs-string">"../auth/custom-auth-checker.ts"</span>;

<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">await</span> buildSchema({
  resolvers: [MyResolver],
  <span class="hljs-comment">// here we register the auth checking function</span>
  <span class="hljs-comment">// or defining it inline</span>
  authChecker: customAuthChecker, 
})
</code></pre>
<p>And it's done! 😉</p>
<p>If you need silent auth guards and you don't want to return auth errors to users, you can set <code>authMode</code> property of <code>buildSchema</code> config object to <code>&quot;null&quot;</code>:</p>
<pre><code class="hljs css ts"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">await</span> buildSchema({
  resolvers: [<span class="hljs-string">"./**/*.resolver.ts"</span>],
  authChecker: customAuthChecker, 
  authMode: <span class="hljs-string">"null"</span>,
})
</code></pre>
<p>It will then return <code>null</code> instead of throwing authorization error.</p>
<h2><a class="anchor" aria-hidden="true" id="recipes"></a><a href="#recipes" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Recipes</h2>
<p>You can also use <code>TypeGraphQL</code> with JWT authentication. Example using <code>graphql-yoga</code>:</p>
<pre><code class="hljs css ts"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> jwt <span class="hljs-keyword">from</span> <span class="hljs-string">"express-jwt"</span>;
<span class="hljs-keyword">import</span> { schema } <span class="hljs-keyword">from</span> <span class="hljs-string">"../example/above"</span>;

<span class="hljs-comment">// Create GraphQL server</span>
<span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> GraphQLServer({
  schema,
  context: <span class="hljs-function">(<span class="hljs-params">{ request }</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> context = {
      request,
      user: request.user, <span class="hljs-comment">// `request.user` comes from `express-jwt`</span>
    };
    <span class="hljs-keyword">return</span> ctx;
  },
});

<span class="hljs-comment">// the rest of bootstrap code, same as always</span>
<span class="hljs-comment">// ...</span>

<span class="hljs-comment">// register JWT middleware</span>
server.express.use(
  server.options.endpoint,
  jwt({ secret: <span class="hljs-string">"TypeGraphQL"</span>, credentialsRequired: <span class="hljs-literal">false</span> }),
);
</code></pre>
<p>Then you can use standard, token based authorization in HTTP header like in classic REST API and take advantages of <code>TypeGraphQL</code> authorization mechanism.</p>
<h2><a class="anchor" aria-hidden="true" id="example"></a><a href="#example" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example</h2>
<p>You can see how this works together in the <a href="https://github.com/19majkel94/type-graphql/tree/master/examples/authorization">simple real life example</a>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="dependency-injection.html">← Dependency injection</a><a class="docs-next button" href="validation.html">Arguments and inputs validation →</a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#how-to-use">How to use?</a></li><li><a href="#recipes">Recipes</a></li><li><a href="#example">Example</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/type-graphql/" class="nav-home"><img src="/type-graphql/img/logo.png" alt="TypeGraphQL" width="66" height="58"/></a><div><h5>Docs</h5><a href="/type-graphql/docs/en/introduction.html">Introduction</a><a href="/type-graphql/docs/en/getting-started.html">Getting Started</a><a href="/type-graphql/docs/en/scalars.html">Advanced Guides</a></div><div><h5>Community</h5><a href="https://github.com/19majkel94/type-graphql/issues?utf8=✓&amp;q=is%3Aissue+label%3A&amp;quot;Enhancement+%3Anew%3A&amp;quot;+">Feature requests and proposals</a><a href="https://github.com/19majkel94/type-graphql/issues?q=is%3Aissue+label%3A&amp;quot;Bug+%3Abug%3A&amp;quot;">Issues</a><a href="https://gitter.im/type-graphql/Lobby">Project Chat</a><a href="https://twitter.com/19majkel94" target="_blank">Twitter</a></div><div><h5>More</h5><a href="/type-graphql/blog">Blog</a><a href="https://github.com/19majkel94/type-graphql">GitHub</a><a class="github-button" href="https://github.com/19majkel94/type-graphql" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2018 Michał Lytek</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-117093147-1', 'auto');
              ga('send', 'pageview');
            </script><script>
              var search = docsearch({
                
                apiKey: '2cf66434100c0e30ca9ff499830e7b77',
                indexName: 'typegraphql',
                inputSelector: '#search_input_react'
              });
            </script></body></html>